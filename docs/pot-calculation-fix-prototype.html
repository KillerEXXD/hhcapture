<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pot Calculation Fix - Before/After Prototype</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 10px;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .comparison {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 40px;
    }

    .section {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .section-header {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e0e0e0;
    }

    .before .section-header {
      color: #dc2626;
      border-bottom-color: #dc2626;
    }

    .after .section-header {
      color: #16a34a;
      border-bottom-color: #16a34a;
    }

    .street-title {
      background: #3b82f6;
      color: white;
      padding: 12px 20px;
      border-radius: 6px;
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 20px;
      text-align: center;
      grid-column: 1 / -1;
    }

    .pot-display {
      font-family: 'Courier New', monospace;
      background: #f8f9fa;
      padding: 15px;
      border-radius: 4px;
      border: 1px solid #dee2e6;
      white-space: pre-wrap;
      font-size: 13px;
      line-height: 1.6;
    }

    .pot-header {
      font-weight: bold;
      color: #1e40af;
      margin-bottom: 8px;
    }

    .calculation-line {
      color: #374151;
      padding: 2px 0;
    }

    .total-line {
      font-weight: bold;
      color: #059669;
      border-top: 1px solid #d1d5db;
      padding-top: 8px;
      margin-top: 8px;
    }

    .missing {
      background: #fee2e2;
      color: #dc2626;
      padding: 10px;
      border-radius: 4px;
      margin-top: 10px;
      font-size: 12px;
      font-family: sans-serif;
    }

    .fixed {
      background: #d1fae5;
      color: #059669;
      padding: 10px;
      border-radius: 4px;
      margin-top: 10px;
      font-size: 12px;
      font-family: sans-serif;
    }

    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: bold;
      margin-left: 10px;
    }

    .badge-error {
      background: #dc2626;
      color: white;
    }

    .badge-success {
      background: #16a34a;
      color: white;
    }

    .scenario {
      background: #fffbeb;
      border-left: 4px solid #f59e0b;
      padding: 12px;
      margin-bottom: 20px;
      font-size: 13px;
    }

    .scenario strong {
      color: #92400e;
    }

    .highlight {
      background: #fef3c7;
      padding: 2px 4px;
      border-radius: 2px;
    }
  </style>
</head>
<body>
  <h1>Pot Calculation Fix - Before/After</h1>
  <p class="subtitle">Showing blinds/antes included for ALL streets (not just preflop)</p>

  <div class="scenario">
    <strong>Test Scenario:</strong> 9-player game, SB=$500, BB=$1,000, Ante=$1,000 (BB only)<br>
    <strong>Players in hand:</strong> Alice (UTG, 10,000 chips) and Charlie (UTG+1, 15,000 chips)<br>
    <strong>Preflop:</strong> Alice bets 3,000, Charlie calls 3,000 ‚Üí Pot = 8,500<br>
    <strong>Flop/Turn/River:</strong> Alice bets 1,000, Charlie calls 1,000 ‚Üí Pot increases by 2,000
  </div>

  <!-- PREFLOP -->
  <div class="comparison">
    <div class="street-title">üÉè PREFLOP - How this pot was calculated</div>

    <div class="section before">
      <div class="section-header">
        ‚ùå BEFORE (v2.0)
        <span class="badge badge-error">BROKEN</span>
      </div>
      <div class="pot-display">
<span class="pot-header">Main Pot: 8,500</span>
<span class="calculation-line">Alice (UTG):             3,000</span>
<span class="calculation-line">Charlie (UTG+1):         3,000</span>
<span class="total-line">Total:                   6,000</span>
      </div>
      <div class="missing">
        ‚ö†Ô∏è <strong>MISSING:</strong> SB ($500), BB ($1,000), Ante ($1,000) = $2,500<br>
        Expected total: $8,500 but only shows $6,000
      </div>
    </div>

    <div class="section after">
      <div class="section-header">
        ‚úÖ AFTER (v2.1)
        <span class="badge badge-success">FIXED</span>
      </div>
      <div class="pot-display">
<span class="pot-header">Main Pot: 8,500</span>
<span class="calculation-line">Posted (SB):             500</span>
<span class="calculation-line">Posted (BB):             1,000</span>
<span class="calculation-line">Alice (UTG):             3,000</span>
<span class="calculation-line">Charlie (UTG+1):         3,000</span>
<span class="calculation-line">Posted (Ante):           1,000</span>
<span class="total-line">Total:                   8,500</span>
      </div>
      <div class="fixed">
        ‚úì Shows SB, BB, and Ante<br>
        ‚úì Total matches pot amount: 8,500
      </div>
    </div>
  </div>

  <!-- FLOP -->
  <div class="comparison">
    <div class="street-title">üé¥ FLOP - How this pot was calculated</div>

    <div class="section before">
      <div class="section-header">
        ‚ùå BEFORE (v2.0)
        <span class="badge badge-error">BROKEN</span>
      </div>
      <div class="pot-display">
<span class="pot-header">Main Pot: 10,500</span>
<span class="calculation-line">Alice (UTG):             4,000</span>
<span class="calculation-line">Charlie (UTG+1):         4,000</span>
<span class="total-line">Total:                   8,000</span>
      </div>
      <div class="missing">
        ‚ö†Ô∏è <strong>MISSING:</strong> SB ($500), BB ($1,000), Ante ($1,000) = $2,500<br>
        Expected total: $10,500 but only shows $8,000<br>
        <strong>BUG:</strong> Blinds/antes REMOVED after preflop!
      </div>
    </div>

    <div class="section after">
      <div class="section-header">
        ‚úÖ AFTER (v2.1)
        <span class="badge badge-success">FIXED</span>
      </div>
      <div class="pot-display">
<span class="pot-header">Main Pot: 10,500</span>
<span class="calculation-line">Posted (SB):             500</span>
<span class="calculation-line">Posted (BB):             1,000</span>
<span class="calculation-line">Alice (UTG):             4,000</span>
<span class="calculation-line">Charlie (UTG+1):         4,000</span>
<span class="calculation-line">Posted (Ante):           1,000</span>
<span class="total-line">Total:                   10,500</span>
      </div>
      <div class="fixed">
        ‚úì Blinds/antes STILL SHOWN (they were posted in preflop)<br>
        ‚úì Action contributions updated (3,000 ‚Üí 4,000)<br>
        ‚úì Total matches pot amount: 10,500
      </div>
    </div>
  </div>

  <!-- TURN -->
  <div class="comparison">
    <div class="street-title">üé≤ TURN - How this pot was calculated</div>

    <div class="section before">
      <div class="section-header">
        ‚ùå BEFORE (v2.0)
        <span class="badge badge-error">BROKEN</span>
      </div>
      <div class="pot-display">
<span class="pot-header">Main Pot: 12,500</span>
<span class="calculation-line">Alice (UTG):             5,000</span>
<span class="calculation-line">Charlie (UTG+1):         5,000</span>
<span class="total-line">Total:                   10,000</span>
      </div>
      <div class="missing">
        ‚ö†Ô∏è <strong>MISSING:</strong> SB ($500), BB ($1,000), Ante ($1,000) = $2,500<br>
        Expected total: $12,500 but only shows $10,000
      </div>
    </div>

    <div class="section after">
      <div class="section-header">
        ‚úÖ AFTER (v2.1)
        <span class="badge badge-success">FIXED</span>
      </div>
      <div class="pot-display">
<span class="pot-header">Main Pot: 12,500</span>
<span class="calculation-line">Posted (SB):             500</span>
<span class="calculation-line">Posted (BB):             1,000</span>
<span class="calculation-line">Alice (UTG):             5,000</span>
<span class="calculation-line">Charlie (UTG+1):         5,000</span>
<span class="calculation-line">Posted (Ante):           1,000</span>
<span class="total-line">Total:                   12,500</span>
      </div>
      <div class="fixed">
        ‚úì Blinds/antes STILL SHOWN<br>
        ‚úì Action contributions updated (4,000 ‚Üí 5,000)<br>
        ‚úì Total matches pot amount: 12,500
      </div>
    </div>
  </div>

  <!-- RIVER -->
  <div class="comparison">
    <div class="street-title">üåä RIVER - How this pot was calculated</div>

    <div class="section before">
      <div class="section-header">
        ‚ùå BEFORE (v2.0)
        <span class="badge badge-error">BROKEN</span>
      </div>
      <div class="pot-display">
<span class="pot-header">Main Pot: 14,500</span>
<span class="calculation-line">Alice (UTG):             6,000</span>
<span class="calculation-line">Charlie (UTG+1):         6,000</span>
<span class="total-line">Total:                   12,000</span>
      </div>
      <div class="missing">
        ‚ö†Ô∏è <strong>MISSING:</strong> SB ($500), BB ($1,000), Ante ($1,000) = $2,500<br>
        Expected total: $14,500 but only shows $12,000
      </div>
    </div>

    <div class="section after">
      <div class="section-header">
        ‚úÖ AFTER (v2.1)
        <span class="badge badge-success">FIXED</span>
      </div>
      <div class="pot-display">
<span class="pot-header">Main Pot: 14,500</span>
<span class="calculation-line">Posted (SB):             500</span>
<span class="calculation-line">Posted (BB):             1,000</span>
<span class="calculation-line">Alice (UTG):             6,000</span>
<span class="calculation-line">Charlie (UTG+1):         6,000</span>
<span class="calculation-line">Posted (Ante):           1,000</span>
<span class="total-line">Total:                   14,500</span>
      </div>
      <div class="fixed">
        ‚úì Blinds/antes STILL SHOWN<br>
        ‚úì Action contributions updated (5,000 ‚Üí 6,000)<br>
        ‚úì Total matches pot amount: 14,500
      </div>
    </div>
  </div>

  <!-- EDGE CASES -->
  <div class="comparison">
    <div class="street-title">‚öôÔ∏è EDGE CASE: Player with Insufficient Chips</div>

    <div class="section before">
      <div class="section-header">
        ‚ùå BEFORE (v2.0)
        <span class="badge badge-error">BROKEN</span>
      </div>
      <div class="scenario" style="margin-bottom: 10px;">
        <strong>Scenario:</strong> BB has only 800 chips (less than BB=$1,000 + Ante=$1,000)
      </div>
      <div class="pot-display">
<span class="pot-header">Main Pot: 4,300</span>
<span class="calculation-line">Alice (UTG):             3,000</span>
<span class="calculation-line">Charlie (UTG+1):         3,000</span>
<span class="total-line">Total:                   6,000</span>
      </div>
      <div class="missing">
        ‚ö†Ô∏è <strong>WRONG:</strong> Shows $6,000 but pot is actually $4,300<br>
        Missing SB ($500) and BB's partial blind ($800, can't post full $1,000+$1,000)
      </div>
    </div>

    <div class="section after">
      <div class="section-header">
        ‚úÖ AFTER (v2.1)
        <span class="badge badge-success">FIXED</span>
      </div>
      <div class="scenario" style="margin-bottom: 10px;">
        <strong>Fix:</strong> Uses <span class="highlight">Math.min(blind, playerStack)</span> to calculate actual posted amount
      </div>
      <div class="pot-display">
<span class="pot-header">Main Pot: 4,300</span>
<span class="calculation-line">Posted (SB):             500</span>
<span class="calculation-line">Posted (BB):             800   (all-in)</span>
<span class="calculation-line">Alice (UTG):             3,000</span>
<span class="calculation-line">Charlie (UTG+1):         3,000</span>
<span class="total-line">Total:                   4,300</span>
      </div>
      <div class="fixed">
        ‚úì BB posts only 800 (all available chips)<br>
        ‚úì No ante shown (BB couldn't afford it after posting blind)<br>
        ‚úì Total matches actual pot: 4,300
      </div>
    </div>
  </div>

  <!-- KEY CHANGES -->
  <div class="comparison">
    <div class="street-title">üîß Key Code Changes (v2.0 ‚Üí v2.1)</div>

    <div class="section" style="grid-column: 1 / -1;">
      <div class="section-header" style="color: #3b82f6; border-bottom-color: #3b82f6;">
        What Changed in potDisplayFormatter.ts
      </div>

      <div style="font-family: 'Courier New', monospace; font-size: 12px; line-height: 1.8;">
        <div style="background: #fee2e2; padding: 10px; border-radius: 4px; margin-bottom: 10px;">
          <strong style="color: #dc2626;">‚ùå OLD CODE (v2.0):</strong><br>
          <code style="color: #991b1b;">
// Only show blinds for preflop<br>
if (<span style="background: #fecaca;">currentStreet === 'preflop'</span>) {<br>
  if (player.position === 'SB') {<br>
    totalContribution += blindAnte.sb;<br>
  }<br>
  if (player.position === 'BB') {<br>
    totalContribution += blindAnte.bb + blindAnte.ante;<br>
  }<br>
}
          </code>
        </div>

        <div style="background: #d1fae5; padding: 10px; border-radius: 4px;">
          <strong style="color: #059669;">‚úÖ NEW CODE (v2.1):</strong><br>
          <code style="color: #065f46;">
// Show blinds for ALL streets (blinds were posted in preflop)<br>
<span style="background: #6ee7b7;">// No currentStreet restriction - blinds always included</span><br>
const isInPot = eligiblePlayers.some(ep => ep.id === player.id);<br>
if (blindAnte && isInPot) {<br>
  if (player.position === 'SB') {<br>
    const sbAmount = <span style="background: #6ee7b7;">Math.min(blindAnte.sb, player.stack)</span>;<br>
    totalContribution += sbAmount;<br>
  } else if (player.position === 'BB') {<br>
    const bbAmount = <span style="background: #6ee7b7;">Math.min(blindAnte.bb, player.stack)</span>;<br>
    totalContribution += bbAmount;<br>
    const remainingAfterBB = Math.max(0, player.stack - blindAnte.bb);<br>
    anteAmount = <span style="background: #6ee7b7;">Math.min(blindAnte.ante, remainingAfterBB)</span>;<br>
  }<br>
}
          </code>
        </div>
      </div>

      <div style="margin-top: 20px; padding: 15px; background: #eff6ff; border-left: 4px solid #3b82f6; font-size: 13px;">
        <strong style="color: #1e40af;">üìã Summary of Changes:</strong><br>
        1Ô∏è‚É£ Removed <code style="background: #dbeafe; padding: 2px 4px;">currentStreet === 'preflop'</code> restriction<br>
        2Ô∏è‚É£ Added <code style="background: #dbeafe; padding: 2px 4px;">Math.min()</code> to calculate actual posted amounts<br>
        3Ô∏è‚É£ Separate ante line for BB (shown after player contributions)<br>
        4Ô∏è‚É£ Detailed console logging for debugging
      </div>
    </div>
  </div>

</body>
</html>
